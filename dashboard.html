<!DOCTYPE html>
<html>
<head>
  <title>Farm Visitor Heatmap</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script src="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.css" rel="stylesheet" />

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

  <style>
    body, html { margin: 0; padding: 0; }
    #map { width: 100vw; height: 100vh; }
  </style>
</head>
<body>

<div id="map"></div>

<script>
  mapboxgl.accessToken = "YOUR_MAPBOX_TOKEN";

  const supabase = supabase.createClient(
    "YOUR_SUPABASE_URL",
    "YOUR_SUPABASE_PUBLIC_KEY"
  );

  const map = new mapboxgl.Map({
    container: "map",
    style: "mapbox://styles/mapbox/satellite-streets-v12",
    center: [0, 0],
    zoom: 14
  });

  map.on("load", async () => {
    let { data } = await supabase.from("visitor_locations").select("lon, lat");

    map.addSource("visitors", {
      type: "geojson",
      data: {
        type: "FeatureCollection",
        features: data.map(p => ({
          type: "Feature",
          geometry: {
            type: "Point",
            coordinates: [p.lon, p.lat]
          }
        }))
      }
    });

    map.addLayer({
      id: "visitor-heat",
      type: "heatmap",
      source: "visitors",
      paint: {
        "heatmap-intensity": 2,
        "heatmap-radius": 30,
        "heatmap-opacity": 0.7
      }
    });
  });
</script>

</body>
</html>
